[platformio]
build_cache_dir = .pio/build_cache

[env:arduino_nano_esp32]
platform = espressif32
board = arduino_nano_esp32
framework = arduino
lib_deps = 
	bblanchon/ArduinoJson@^7.4.1
	adafruit/Adafruit ADS1X15@^2.5.0
	https://github.com/imax9000/Arduino-PID-Library.git
	littlefs

; === Upload Configuration ===
; Use usb_reset to handle ESP32-S3 native USB CDC re-enumeration issue.
; Without this, the COM port disappears after first upload and esptool can't reconnect.
; upload_protocol = dfu
upload_protocol = dfu
upload_speed = 921600
board_upload.before_reset = usb_reset

; Pre-upload script to reset USB device if COM port is stuck
extra_scripts = 
    pre:embed_web.py
    pre:inject_version.py
    usb_reset_pre_upload.py

; Force hard reset after upload to ensure WiFi peripheral reinitializes
monitor_rts = 0
monitor_dtr = 0

; === Build Speed Optimization ===
; Disable debug logging for smaller/faster binary
build_flags = 
    -DCORE_DEBUG_LEVEL=0

; === Filesystem ===
board_build.filesystem = littlefs
board_build.partitions = default_16MB.csv